name: autocommit-robot

on:
  schedule:
    - cron: "0 * * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    env:
      TZ: Asia/Shanghai
      GITHUB_TOKEN: ${{ secrets.ACCOUNT_TOKEN }}

    steps:
      - name: "Checkout code"
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.ACCOUNT_TOKEN }}
          submodules: true

      - name: "Set node"
        uses: actions/setup-node@v4
        with:
          node-version: 22.x

      - name: Cache node modules
        uses: actions/cache@v4
        id: cache
        with:
          path: |
            node_modules
            ~/.yarn/cache
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          restore-keys: |
            ${{ runner.os }}-yarn-

      - name: "Install"
        if: steps.cache.outputs.cache-hit != 'true'
        run: yarn install --frozen-lockfile

      - name: "Generate commit message"
        id: commit-message
        run: |
          EMOJIS=(
            "ðŸ¤–" "ðŸ’»" "âŒ¨ï¸" "ðŸ–¥ï¸" "ðŸ–²ï¸" "ðŸŽ®" "ðŸ•¹ï¸" "ðŸ“±" "â˜Žï¸" "âŒšï¸" "âš¡ï¸" "ðŸ’¡" "ðŸ”Œ" "ðŸ”‹"
            "ðŸŽ¨" "ðŸŽ­" "ðŸŽª" "ðŸŽ " "ðŸŽ¬" "ðŸ“¸" "ðŸŽ¥" "ðŸŽ™ï¸" "ðŸŽ§" "ðŸŽ¹" "ðŸŽ¼" "ðŸŽµ" "ðŸŽ¶" "ðŸ–¼ï¸"
            "âœ¨" "ðŸ’«" "ðŸŒŸ" "â­ï¸" "âœ´ï¸" "ðŸ”®" "ðŸª„" "ðŸŽ‡" "ðŸŽ†" "ðŸŒ " "ðŸŒŒ" "ðŸ‘¾" "ðŸ›¸" "ðŸŒ"
            "ðŸ”§" "ðŸ”¨" "âš’ï¸" "ðŸ› ï¸" "âš™ï¸" "ðŸ”©" "â›“ï¸" "ðŸ“" "ðŸ“" "âœ‚ï¸" "ðŸ—œï¸" "ðŸ“Œ" "ðŸ”" "ðŸ’Ž"
            "ðŸŽ¯" "ðŸŽª" "ðŸ†" "ðŸ…" "ðŸŽ–ï¸" "ðŸ”" "ðŸ“ˆ" "ðŸ’¯" "ðŸŽ³" "ðŸŽ²" "ðŸŽ±" "ðŸ§©" "â™Ÿï¸" "ðŸŽ°"
            "ðŸš€" "âœˆï¸" "ðŸ›©ï¸" "ðŸ›°ï¸" "ðŸŒˆ" "ðŸŒŠ" "ðŸ’¨" "ðŸŒªï¸" "âš¡ï¸" "ðŸ”¥" "ðŸ’¥" "ðŸŽ¢" "ðŸŽ¡" "ðŸŽª"
            "ðŸ’¡" "ðŸ’­" "ðŸ’«" "ðŸ§ " "ðŸŽ‰" "ðŸŽŠ" "ðŸŒŸ" "ðŸ’ª" "ðŸ“š" "ðŸ”¬" "ðŸ§ª" "ðŸ§¬" "ðŸ”­" "âš—ï¸"
            "ðŸ‘½" "ðŸ¤–" "ðŸ‘¾" "ðŸ›¸" "ðŸŒŒ" "ðŸŒ " "ðŸš€" "ðŸ’«" "âœ¨" "ðŸ”®" "ðŸŽ†" "ðŸŽ‡" "â­ï¸" "ðŸŒŸ"
            "ðŸ—ï¸" "ðŸ¢" "ðŸ­" "ðŸ›ï¸" "ðŸ˜ï¸" "ðŸ°" "ðŸ—¼" "ðŸ—½" "ðŸ—¿" "ðŸŽª" "ðŸŒ‰" "ðŸŒ‡" "ðŸŒ†" "ðŸŒƒ"
            "ðŸ“¡" "ðŸ“±" "ðŸ“Ÿ" "ðŸ“ " "ðŸ”Œ" "ðŸ”‹" "ðŸ’»" "ðŸ–¥ï¸" "âŒ¨ï¸" "ðŸ–±ï¸" "ðŸ–¨ï¸" "ðŸ–²ï¸" "ðŸ“¼" "ðŸ’½"
          )
          RANDOM_EMOJI=${EMOJIS[$RANDOM % ${#EMOJIS[@]}]}

          DATETIME=$(date '+%Y-%m-%d %H:%M:%S')

          DESCRIPTIONS=(
            "ä»»ä½•è¶³å¤Ÿå…ˆè¿›çš„æŠ€æœ¯ï¼Œéƒ½ä¸Žé­”æ³•æ— å¼‚ã€‚â€”â€”äºšç‘ŸÂ·å…‹æ‹‰å…‹"
            "é¢„æµ‹æœªæ¥çš„æœ€å¥½æ–¹å¼å°±æ˜¯åˆ›é€ å®ƒã€‚â€”â€”è‰¾ä¼¦Â·å‡¯"
            "åˆ›æ–°å°±æ˜¯æŠŠä¸åŒçš„äº‹ç‰©è”ç³»èµ·æ¥ã€‚â€”â€”å²è’‚å¤«Â·ä¹”å¸ƒæ–¯"
            "è‰ºæœ¯çš„ç›®æ ‡æ˜¯æ´—åŽ»çµé­‚æ²¾æŸ“çš„æ—¥å¸¸å°˜åŸƒã€‚â€”â€”æ¯•åŠ ç´¢"
            "æˆ‘ä»¬å¡‘é€ å·¥å…·ï¼Œç„¶åŽå·¥å…·å¡‘é€ æˆ‘ä»¬ã€‚â€”â€”éº¦å…‹å¢æ±‰"
            "é€»è¾‘å¸¦ä½ ä»ŽAåˆ°Bï¼Œæƒ³è±¡åŠ›å¸¦ä½ åŽ»ä»»ä½•åœ°æ–¹ã€‚â€”â€”çˆ±å› æ–¯å¦"
            "ç§‘æŠ€çš„æœ€é«˜å¢ƒç•Œæ˜¯è®©äººæ„Ÿå—ä¸åˆ°ç§‘æŠ€çš„å­˜åœ¨ã€‚â€”â€”å¼ å°é¾™"
            "æ¯ä¸ªä¼Ÿå¤§çš„è®¾è®¡éƒ½å§‹äºŽä¸€ä¸ªæ›´ä½³çš„æ•…äº‹ã€‚â€”â€”æ´›æž—Â·æ ¼èŽ±å¾·æ›¼"
            "æœºå™¨åº”è¯¥å·¥ä½œï¼Œäººç±»åº”è¯¥æ€è€ƒã€‚â€”â€”IBMåˆ›å§‹ç†å¿µ"
            "æœªæ¥å±žäºŽé‚£äº›ç›¸ä¿¡æ¢¦æƒ³ä¹‹ç¾Žçš„äººã€‚â€”â€”åŸƒèŽ‰è¯ºÂ·ç½—æ–¯ç¦"
            "åˆ›é€ æ˜¯å…è®¸è‡ªå·±çŠ¯é”™ï¼Œè‰ºæœ¯æ˜¯çŸ¥é“ä¿ç•™å“ªäº›ã€‚â€”â€”æ–¯ç§‘ç‰¹Â·äºšå½“æ–¯"
            "æ•°å­—é©å‘½è¿œæœªç»“æŸï¼Œå®ƒæ‰åˆšåˆšå¼€å§‹ã€‚â€”â€”è’‚å§†Â·åº“å…‹"
            "ç§‘å­¦æ˜¯ç»„ç»‡çš„çŸ¥è¯†ï¼Œæ™ºæ…§æ˜¯ç»„ç»‡çš„ç”Ÿæ´»ã€‚â€”â€”åº·å¾·"
            "æˆ‘ä»¬ä¸æ˜¯æœºå™¨ä¸­é½¿è½®ï¼Œè€Œæ˜¯æœºå™¨çš„åˆ›é€ è€…ã€‚â€”â€”èŽ±æ˜‚Â·å·´è’‚æ–¯å¡”Â·é˜¿å°”ä¼¯è’‚"
            "çœŸæ­£çš„å‘çŽ°ä¹‹æ—…ä¸åœ¨äºŽå¯»æ‰¾æ–°é£Žæ™¯ï¼Œè€Œåœ¨äºŽæ‹¥æœ‰æ–°çœ¼ç›ã€‚â€”â€”æ™®é²æ–¯ç‰¹"
            "æŠ€æœ¯æœ¬èº«æ²¡æœ‰å–„æ¶ï¼Œå…¨çœ‹äººç±»å¦‚ä½•ä½¿ç”¨ã€‚â€”â€”çˆ±å› æ–¯å¦"
            "å®Œç¾Žä¸åœ¨äºŽæ— å¯å¢žåŠ ï¼Œè€Œåœ¨äºŽæ— å¯åˆ å‡ã€‚â€”â€”åœ£åŸƒå…‹è‹ä½©é‡Œ"
            "æœªæ¥å·²ç»åˆ°æ¥ï¼Œåªæ˜¯åˆ†å¸ƒä¸å‡ã€‚â€”â€”å¨å»‰Â·å‰å¸ƒæ£®"
            "æƒ³è±¡åŠ›æ¯”çŸ¥è¯†æ›´é‡è¦ã€‚â€”â€”çˆ±å› æ–¯å¦"
            "æ¯ä¸ªåˆ›é€ æœ€åˆéƒ½æ˜¯æ‰“ç ´å¸¸è§„çš„è¡Œä¸ºã€‚â€”â€”å“ˆå‹ƒÂ·é©¬ç§‘æ–¯"
            "è‰ºæœ¯ä¸æ˜¯å¤åˆ¶å¯è§ï¼Œè€Œæ˜¯åˆ›é€ å¯è§ã€‚â€”â€”ä¿ç½—Â·å…‹åˆ©"
            "æˆ‘ä»¬ä¸æ˜¯ç»§æ‰¿çˆ¶è¾ˆçš„ä¸–ç•Œï¼Œè€Œæ˜¯å€Ÿç”¨å„¿å­™çš„ä¸–ç•Œã€‚â€”â€”å°ç¬¬å®‰è°šè¯­"
            "æ™ºèƒ½çš„æ ‡å¿—ä¸æ˜¯çŸ¥è¯†ï¼Œè€Œæ˜¯æƒ³è±¡åŠ›ã€‚â€”â€”çˆ±å› æ–¯å¦"
            "è®¾è®¡ä¸åªæ˜¯å¤–è§‚ï¼Œè®¾è®¡æ˜¯åŠŸèƒ½å¦‚ä½•è¿ä½œã€‚â€”â€”å²è’‚å¤«Â·ä¹”å¸ƒæ–¯"
            "ç§‘æŠ€çš„æœ€é«˜å¢ƒç•Œæ˜¯æ¨¡æ‹Ÿç”Ÿå‘½çš„ä¼˜é›…ã€‚â€”â€”å·´å…‹æ•æ–¯ç‰¹Â·å¯Œå‹’"
            "åˆ›æ–°éœ€è¦ä¸¤ç§å“è´¨ï¼šå¥½å¥‡å¿ƒä¸Žå‹‡æ°”ã€‚â€”â€”åŸƒéš†Â·é©¬æ–¯å…‹"
            "æœªæ¥å±žäºŽèƒ½å°†ä¸å¯èƒ½å˜ä¸ºå¯èƒ½çš„é€ æ¢¦è€…ã€‚â€”â€”è‰¾ä¼¦Â·å‡¯"
            "çœŸæ­£çš„è‰ºæœ¯æ˜¯è®©ä¸å¯è§æˆä¸ºå¯è§ã€‚â€”â€”ä¿ç½—Â·å…‹åˆ©"
            "æˆ‘ä»¬åˆ›é€ çš„æ¯ä»¶ç‰©å“éƒ½æ˜¯è‡ªæˆ‘è‚–åƒã€‚â€”â€”æ‰˜é©¬æ–¯Â·èŽ«é¡¿"
            "æœºå™¨å¯ä»¥å›žç­”é—®é¢˜ï¼Œä½†åªæœ‰äººç±»èƒ½æå‡ºé—®é¢˜ã€‚â€”â€”åˆ—ç»´ç‰¹"
          )
          RANDOM_DESC=${DESCRIPTIONS[$RANDOM % ${#DESCRIPTIONS[@]}]}

          ACTIONS=("feat" "update" "create" "generate" "implement" "design" "craft" "develop")
          RANDOM_ACTION=${ACTIONS[$RANDOM % ${#ACTIONS[@]}]}

          SCOPES=("robot" "ai" "avatar" "design" "generator" "collection")
          RANDOM_SCOPE=${SCOPES[$RANDOM % ${#SCOPES[@]}]}

          MESSAGE="${RANDOM_EMOJI} ${RANDOM_ACTION}(${RANDOM_SCOPE}): ${RANDOM_DESC} [${DATETIME}]"
          echo "message=${MESSAGE}" >> $GITHUB_OUTPUT

      - name: "Run bash"
        run: yarn writer

      - name: Setup SSH Key
        run: |
          mkdir -p ~/.ssh/
          echo "${{ secrets.HEXO_DEPLOY_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -t rsa github.com >> ~/.ssh/known_hosts

      - name: Setup Git Config
        run: |
          git config --global user.name "iosxx"
          git config --global user.email "840263997@qq.com"

      - name: Install Hexo
        run: |
          yarn global add hexo-cli
          yarn add hexo-deployer-git

      - name: Deploy Hexo
        run: hexo g -d -m "${{ steps.commit-message.outputs.message }}"

      - name: "Commit and Push"
        run: |
          git config --global user.email "840263997@qq.com"
          git config --global user.name "iosxx"
          git add source/*
          git commit -m "${{ steps.commit-message.outputs.message }}" || echo "No changes to commit"
          git push origin HEAD:${GITHUB_REF#refs/heads/}
